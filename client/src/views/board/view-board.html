<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../style/shared-styles.html">
<link rel="import" href="../../style/board-table.html">
<link rel="import" href="../../style/button-style.html">

<dom-module id="view-board">
  <template>
    <style include="board-table"></style>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }

      .board-title {
        font-size: 30px;
        font-weight: bold;
        text-align: center;
      }

      .board-footer {
        max-width: 750px;
        text-align: center;
        margin: 50px auto 20px auto;
      }
      
      .btn-add {
        float:right;
      }

      hr {
        max-width: 750px;
      }
    </style>
    <app-location route="{{route}}"></app-location>
    <app-route
      route="{{route}}"
      pattern="/board/:pageNum"
      data="{{routeData}}">
    </app-route>

    <iron-ajax
      auto
      id="ajax-select-board-list"
      url="[[selectBoardListUrl]]"
      params='[[selectBoardListPrams]]'
      handle-as="json"
      method="GET"
      on-response="_selectBoardListResponse"
      debounce-duration="300">
    </iron-ajax>

    <div class="container">
        <div class="board-title">[[boardTitle]]</div>

        <table>
          <colgroup>
            <col style="width:5%"/>
            <col style="width:50%"/>
            <col style="width:20%"/>
            <col style="width:15%"/>
            <col style="width:15%"/>
          </colgroup>
          <tr>
            <th>번호</th>
            <th>제목</th>
            <th>작성자</th>
            <th>작성일</th>
            <th>조회수</th>
          </tr>
          <template is="dom-repeat" items="[[boardList]]">
            <tr>
              <td>[[item.sequence]]</td>
              <a href=""><td>[[item.title]]</td></a>
              <td>[[item.id]]</td>
              <td>[[item.created_at]]</td>
              <td>[[item.view_count]]</td>
            </tr>
          </template>
        </table>
        <hr>

        <div class="board-footer">
          <select id="type-select" >
            <option value="title" selected>제목</option>
            <option value="id">작성자</option>
            <option value="contents">내용</option>
            <option value="title_contents">제목+내용</option>
          </select>

          <input id="type-input">

          <button id="type-submit" on-click="_typeSubmit">
            검색
          </button>

          <a name="write-board" href="/write_board">
            <button class="btn-add">새 글 쓰기</button>
          </a>
          
        </div>
    </div>

  </template>

  <script>
    Polymer({
      is: 'view-board',

      properties: {
        boardTitle: {
          type: String,
          value: '게시판'
        },

        route: {
          type: String,
          observer: '_routeChanged'
        },

        pageNum: {
          type: String,
          value: 1
        },

        boardList: {
          type: Array
        }
      },
      
      created: function() {
        console.log('view-borad-created')
      },

      attached: function() {
        console.log('view-borad-attached')
      },
      
      _routeChanged: function(route) {
        if(route.path.split('/')[1] == 'board'){
          this._getBoardList();
        }
      },

      _getBoardList: function() {
        let type = this.$['type-select'].value;
        let contents = this.$['type-input'].value;
        let pageNum = this.pageNum;

        this.selectBoardListPrams = {
          pageNum,
          type,
          contents
        };
        
        this.selectBoardListUrl = '/board/select-board.php';
        this.$['ajax-select-board-list'].generateRequest();
      },

      _selectBoardListResponse: function(e) {
        console.log(e)
        this.boardList = e.detail.response;
      },

      _typeSubmit: function(e) {
        this._getBoardList();
      }
    });
  </script>
</dom-module>
